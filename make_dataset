#!/bin/bash

echo "$PWD"
DATE=`date +%Y%m%d`
#echo "Get data"
#scp repo.rism.info:/home/stephan/BSB/pool/muscat3_export.tar.gz input/
#cp input/muscat3_export.tar.gz input/dataset_$DATE.tar.gz
#tar -xzvf input/muscat3_export.tar.gz -C input

echo "Sources"
##mv export.xml rism_sources.xml
##sed -i '/<collection>/c\<collection xmlns="http://www.loc.gov/MARC21/slim">' input/rism_sources.xml
#ruby marcxml --transform -i input/rism_sources.xml -c conf/transform_sources_muscat.yaml -o export/muscat/sources2.xml
#ruby marcxml --analyze -i export/muscat/sources2.xml -o export/muscat/sources_analyze.txt -c

echo "People"
ruby marcxml --transform -i input/rism_pe.xml -c conf/transform_person.yaml -o export/muscat/people2.xml
ruby marcxml --analyze -i export/muscat/people2.xml -o export/muscat/people_analyze.txt -c

echo "Catalogue"
#ruby marcxml --transform -i input/rism_lit.xml -c conf/transform_catalogue.yaml -o export/muscat/catalogue2.xml
#ruby marcxml --analyze -i export/muscat/catalogue2.xml -o export/muscat/catalogue_analyze.txt -c

echo "Institutions"
#ruby marcxml --transform -i input/rism_ks.xml -c conf/transform_institutions.yaml -o export/muscat/institutions2.xml
#ruby marcxml --analyze -i export/muscat/institutions2.xml -o export/muscat/institutions_analyze.txt -c

echo "Digital Objects"
#cp input/rism_mm.xml export/muscat/digital_objects.xml

echo "Create Archive"
tar -czf export/muscat/muscat3data_$DATE.tar.gz export/muscat/*2.xml export/muscat/*2.txt

echo "Completed!"
##ruby marcxml-transform -i input/sample1.xml -r conf/transform_sources_muscat.yaml -o export/muscat/sample.xml
